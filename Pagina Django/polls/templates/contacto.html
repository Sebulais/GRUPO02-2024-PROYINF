{% extends 'base.html' %}
<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat de Ayuda</title>
</head>
<body>
    {% block content %}
    <style>
        .banner {
            background-image: url("https://opia.fia.cl/601/channels-501_bg_encabezado_opia22.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
            padding: 2.5em; /* Reduced vertical padding */
            text-align: left;
        }
        .message {
            margin: 0.5em 0;
        }
        .message.user {
            color: blue;
        }
        .message.bot {
            color: green;
        }
    </style>
    <section class="banner">
        <div class="container">
            <h1>Chat de Retroalimentación con la IA</h1>
        </div>
    </section>
    <section class="news-section py-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="container">
                    <div class="chat-container" id="chat-container">
                        <div class="chat-box" id="messages"></div>
                        <div class="chat-input">
                            <input type="text" id="user-input" placeholder="Escribe tu pregunta aquí..." onkeydown="handleKeyDown(event)" />
                            <button class="send-button" onclick="sendMessage()">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <script>
    let messageCount = 0;
    const bannedWords = ["mierda", "venecos", "hueon", "saco huea", "ctm", "concha", "negro", "weko", "pico",]; // Lista de palabras ofensivas
    
    function sendMessage() {
        const userMessage = document.getElementById("user-input").value.trim();
        if (userMessage === "") return;

        // Verificar si contiene palabras ofensivas
        const containsBannedWord = bannedWords.some(word => userMessage.toLowerCase().includes(word));
        if (containsBannedWord) {
            alert("El mensaje contiene palabras inapropiadas. Por favor, reformula tu mensaje.");
            document.getElementById("user-input").value = "";
            return;
        }
    
        // Agregar mensaje del usuario
        const messagesContainer = document.getElementById("messages");
        messagesContainer.innerHTML += `<div class="message user">${userMessage}</div>`;
        document.getElementById("user-input").value = "";
    
        messageCount++;
    
        // Crear respuesta de la IA
        let botReply = "";
        if (messageCount === 1) {
            botReply = "Hola ¿En qué puedo ayudarte?";
        } else if (messageCount === 2) {
            botReply = "Entendido, intentaré que esa sugerencia se aplique correctamente con lo que me has pedido.";
        } else {
            botReply = "Gracias por tu mensaje. Estoy procesando la información.";
        }
    
        // Agregar mensaje de la IA
        setTimeout(() => {
            messagesContainer.innerHTML += `<div class="message bot">${botReply}</div>`;
            messagesContainer.scrollTop = messagesContainer.scrollHeight; // Desplazarse al final
        }, 500);
    }
    
    function handleKeyDown(event) {
        if (event.key === "Enter") {
            event.preventDefault(); // Evita el salto de línea
            sendMessage();
        }
    }
    </script>
    
    {% endblock %}
</body>
</html>
